# =============================================================================
# Scylla Cluster Sync - Default Values
# Common configuration shared across all environments
# =============================================================================

# -----------------------------------------------------------------------------
# Global Configuration
# -----------------------------------------------------------------------------
global:
  imageRegistry: ghcr.io/enginevector
  imagePullPolicy: IfNotPresent
  imagePullSecrets: []
  commonLabels:
    app.kubernetes.io/part-of: scylla-cluster-sync
    app.kubernetes.io/managed-by: helm
  commonAnnotations: {}

# -----------------------------------------------------------------------------
# Service: Dual-Writer
# Write proxy that handles dual-write operations
# -----------------------------------------------------------------------------
dualWriter:
  enabled: true
  
  replicaCount: 2
  
  image:
    repository: dual-writer
    tag: ""
    pullPolicy: ""
  
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi
  
  service:
    type: ClusterIP
    port: 9042
    metricsPort: 9090
  
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"
  
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL
  
  livenessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 10
    periodSeconds: 15
    timeoutSeconds: 5
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3
  
  nodeSelector: {}
  tolerations: []
  affinity: {}
  topologySpreadConstraints: []
  
  pdb:
    enabled: true
    minAvailable: 1

# -----------------------------------------------------------------------------
# Service: Dual-Reader
# Consistency validation service
# -----------------------------------------------------------------------------
dualReader:
  enabled: true
  
  replicaCount: 2
  
  image:
    repository: dual-reader
    tag: ""
    pullPolicy: ""
  
  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  
  service:
    type: ClusterIP
    port: 8082
    metricsPort: 9091
  
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9091"
    prometheus.io/path: "/metrics"
  
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL
  
  livenessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 10
    periodSeconds: 15
    timeoutSeconds: 5
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3
  
  nodeSelector: {}
  tolerations: []
  affinity: {}
  topologySpreadConstraints: []
  
  pdb:
    enabled: true
    minAvailable: 1

# -----------------------------------------------------------------------------
# Service: SSTable-Loader
# Bulk data migration service
# -----------------------------------------------------------------------------
sstableLoader:
  enabled: true
  
  replicaCount: 1
  
  image:
    repository: sstable-loader
    tag: ""
    pullPolicy: ""
  
  resources:
    requests:
      cpu: 1000m
      memory: 2Gi
    limits:
      cpu: 4000m
      memory: 8Gi
  
  service:
    type: ClusterIP
    port: 8081
    metricsPort: 9092
  
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9092"
    prometheus.io/path: "/metrics"
  
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop:
        - ALL
  
  livenessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 15
    periodSeconds: 20
    timeoutSeconds: 10
    failureThreshold: 3
  
  readinessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 10
    periodSeconds: 15
    timeoutSeconds: 5
    failureThreshold: 3
  
  persistence:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 10Gi
    mountPath: /checkpoints
  
  nodeSelector: {}
  tolerations: []
  affinity: {}
  topologySpreadConstraints: []
  
  pdb:
    enabled: false

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
database:
  source:
    driver: cassandra
    hosts:
      - cassandra.source.svc.cluster.local
    port: 9042
    keyspace: production
    connectionTimeoutSecs: 5
    requestTimeoutSecs: 10
    poolSize: 4
  
  target:
    driver: scylla
    hosts:
      - scylla-client.target.svc.cluster.local
    port: 9042
    keyspace: production
    connectionTimeoutSecs: 5
    requestTimeoutSecs: 10
    poolSize: 4

# -----------------------------------------------------------------------------
# Writer Configuration
# -----------------------------------------------------------------------------
writer:
  mode: DualAsync
  shadowTimeoutMs: 5000
  retryIntervalSecs: 60
  maxRetryAttempts: 3
  batchSize: 100

# -----------------------------------------------------------------------------
# Filter Configuration
# -----------------------------------------------------------------------------
filter:
  enabled: false
  rulesConfigMap: ""
  rules:
    blacklistedTenants: []
    blacklistedTables: []
    whitelistedTenants: []
    whitelistedTables: []

# -----------------------------------------------------------------------------
# Index Management
# -----------------------------------------------------------------------------
indexManager:
  enabled: true
  strategy: sequential
  concurrency: 4
  indexesConfigMap: ""
  indexes: []

# -----------------------------------------------------------------------------
# Gateway API Configuration
# -----------------------------------------------------------------------------
gateway:
  enabled: false
  create: false
  name: scylla-cluster-sync-gateway
  gatewayClassName: envoy-gateway
  
  listeners:
    - name: http
      protocol: HTTP
      port: 80
    - name: https
      protocol: HTTPS
      port: 443
      tls:
        mode: Terminate
        certificateRefs:
          - name: migration-tls
            kind: Secret
  
  routes:
    dualWriter:
      enabled: true
      hostnames:
        - migration.example.com
      path: /write
      pathType: PathPrefix
    
    dualReader:
      enabled: true
      hostnames:
        - migration.example.com
      path: /validate
      pathType: PathPrefix
    
    sstableLoader:
      enabled: true
      hostnames:
        - migration.example.com
      path: /migration
      pathType: PathPrefix

# -----------------------------------------------------------------------------
# External Secrets Configuration
# -----------------------------------------------------------------------------
externalSecrets:
  enabled: false
  
  secretStore:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  
  refreshInterval: 1h
  
  secrets:
    sourceDatabase:
      remoteRef:
        key: scylla-cluster-sync/source-database
      properties:
        - username
        - password
    
    targetDatabase:
      remoteRef:
        key: scylla-cluster-sync/target-database
      properties:
        - username
        - password

# -----------------------------------------------------------------------------
# Scaling Configuration
# -----------------------------------------------------------------------------
scaling:
  vpa:
    enabled: false
    updateMode: Auto
    
    dualWriter:
      minAllowed:
        cpu: 250m
        memory: 256Mi
      maxAllowed:
        cpu: 4000m
        memory: 4Gi
    
    dualReader:
      minAllowed:
        cpu: 100m
        memory: 128Mi
      maxAllowed:
        cpu: 2000m
        memory: 2Gi
    
    sstableLoader:
      minAllowed:
        cpu: 500m
        memory: 1Gi
      maxAllowed:
        cpu: 8000m
        memory: 16Gi
  
  hpa:
    enabled: false
    
    dualWriter:
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 80
    
    dualReader:
      minReplicas: 2
      maxReplicas: 5
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 80
  
  keda:
    enabled: false
    pollingInterval: 30
    cooldownPeriod: 300
    
    dualWriter:
      minReplicas: 2
      maxReplicas: 20
      triggers:
        - type: redis
          metadata:
            address: redis.default.svc.cluster.local:6379
            listName: dual-writer-queue
            listLength: "100"
    
    sstableLoader:
      minReplicas: 1
      maxReplicas: 5
      triggers:
        - type: redis
          metadata:
            address: redis.default.svc.cluster.local:6379
            listName: migration-tasks
            listLength: "10"

# -----------------------------------------------------------------------------
# Monitoring Configuration
# -----------------------------------------------------------------------------
monitoring:
  serviceMonitor:
    enabled: false
    namespace: ""
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
    honorLabels: true
  
  prometheusRule:
    enabled: false
    namespace: ""
    labels: {}
    rules: []

# -----------------------------------------------------------------------------
# Service Account
# -----------------------------------------------------------------------------
serviceAccount:
  create: true
  name: ""
  annotations: {}
  labels: {}

# -----------------------------------------------------------------------------
# Network Policies
# -----------------------------------------------------------------------------
networkPolicy:
  enabled: false
  ingressNamespaces:
    - default
    - monitoring
  egressNamespaces:
    - database
    - scylla

# -----------------------------------------------------------------------------
# Extra Configuration
# -----------------------------------------------------------------------------
extraEnv: []
extraVolumes: []
extraVolumeMounts: []